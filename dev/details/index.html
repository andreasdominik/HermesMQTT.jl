<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Some details · hermesMQTT.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="hermesMQTT.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">hermesMQTT.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li class="is-active"><a class="tocitem" href>Some details</a><ul class="internal"><li><a class="tocitem" href="#Strategy"><span>Strategy</span></a></li><li><a class="tocitem" href="#Reduce-false-activations-of-intents-by-using-the-same-intent-for-on/off"><span>Reduce false activations of intents by using the same intent for on/off</span></a></li><li><a class="tocitem" href="#Reduce-false-activations-of-intents-by-doublechecking-commands"><span>Reduce false activations of intents by doublechecking commands</span></a></li><li><a class="tocitem" href="#Reduce-false-activations-of-intents-by-disabling-intents"><span>Reduce false activations of intents by disabling intents</span></a></li><li><a class="tocitem" href="#Ask-and-answer-Yes-or-No"><span>Ask and answer Yes-or-No</span></a></li><li><a class="tocitem" href="#Continue-conversation-without-hotword"><span>Continue conversation without hotword</span></a></li><li><a class="tocitem" href="#Multi-language-support"><span>Multi-language support</span></a></li><li><a class="tocitem" href="#Publishing-intents-programmically"><span>Publishing intents programmically</span></a></li><li><a class="tocitem" href="#Managing-the-Julia-footprint"><span>Managing the Julia footprint</span></a></li></ul></li><li><a class="tocitem" href="../makeskill/">New skill tutorial</a></li><li><a class="tocitem" href="../api/">API Reference</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Some details</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Some details</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/andreasdominik/HermesMQTT.jl/blob/main/docs/src/details.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Some-details"><a class="docs-heading-anchor" href="#Some-details">Some details</a><a id="Some-details-1"></a><a class="docs-heading-anchor-permalink" href="#Some-details" title="Permalink"></a></h1><h2 id="Strategy"><a class="docs-heading-anchor" href="#Strategy">Strategy</a><a id="Strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Strategy" title="Permalink"></a></h2><p>The idea behind the framework is to put as much as possible in the background, so that a developer only needs to provide the code for the functions executed for an intent.</p><p>The MQTT-messages of <em>Hermes</em> and the <em>Dialogue Manager</em> are wrapped and additional interfaces to <em>Hermes</em> are provided to enable direct dialogues without using callbacks.</p><p>In addion background information, such as current session-ID or current site-ID, are handled in the background and are not exposed to a skill developer.</p><p>Additional utilities are provided to</p><ul><li>read values from intent slots,</li><li>read values from <code>config.ini</code>,</li><li>write apps for more then one language,</li><li>get an answer form the NLU back as function value in the control flow of a function,</li><li>use a global intent for switching a device on or off,</li><li>let the assistant ask a question and get &quot;yes&quot; or &quot;no&quot; back as boolean value,</li><li>let the assistant continue a conversation without the need to utter the, hotword again,</li><li>execute actions of other skills by submitting intents.</li></ul><h2 id="Reduce-false-activations-of-intents-by-using-the-same-intent-for-on/off"><a class="docs-heading-anchor" href="#Reduce-false-activations-of-intents-by-using-the-same-intent-for-on/off">Reduce false activations of intents by using the same intent for on/off</a><a id="Reduce-false-activations-of-intents-by-using-the-same-intent-for-on/off-1"></a><a class="docs-heading-anchor-permalink" href="#Reduce-false-activations-of-intents-by-using-the-same-intent-for-on/off" title="Permalink"></a></h2><p>The on/off-intent, integrated with the SnipsHermesQnD framework, allows for writing apps to power up or down devices, without the need to create a new intent for every device.</p><p>Background: All home assistants run into problems when many intents are responsible to switch on or off a device. Obviously all these intends are very similar and reliable detection of the correct intent is not easy.</p><p>HermesMQTT tries to work around this issue, by using only one intent for all on/off-commands.</p><p>All supported devices are listed in the slot <code>device</code> of the intent <code>Susi:on_off</code> and defined in the slot type <code>device_list</code> in  the profile file `hermes_mqtt.ini.</p><p>If you want to use the intent to swich an additional device on or off</p><ul><li>firstly look in the intent <code>Susi:on_off</code> if the device is already defined in the slot type <code>device_list</code>. If not, you will have to add a new device to the values of the slot type <code>device_list</code>.</li><li>secondly a <code>my_action_on_of(topic, payload)</code>  function must be defined in the new skill that performs the action. The function must be registered to the  framework by adding a <code>register_on_off_action(my_action_on_of)</code> command to <code>config.jl</code></li><li>The framework comes with a function  <code>is_on_off_matched(payload, DEVICE_NAME)</code> which can be called with the current payload and the name (and optionally with the siteId) of the device of interest. It will return one of<ul><li><code>:on</code>, if an &quot;ON&quot; is recognised for the device</li><li><code>:off</code>, if an &quot;OFF&quot; is recognised for the device</li><li><code>:matched</code>, if the device is recognised but no specific on or off</li><li><code>:unmatched</code>, if the device is not recognised.</li></ul></li></ul><p>The tutorial shows a simple example how to use this functionality.</p><h2 id="Reduce-false-activations-of-intents-by-doublechecking-commands"><a class="docs-heading-anchor" href="#Reduce-false-activations-of-intents-by-doublechecking-commands">Reduce false activations of intents by doublechecking commands</a><a id="Reduce-false-activations-of-intents-by-doublechecking-commands-1"></a><a class="docs-heading-anchor-permalink" href="#Reduce-false-activations-of-intents-by-doublechecking-commands" title="Permalink"></a></h2><p>Intents with simple commands or without slots are sometimes recognised by Snips with high confidence, even if only parts of the command matches. This is because Snips tries to find the best matching intent for every uttered command.</p><p>The HermesMQTT-framework provides a mechanism to cancel intents, recognised by the NLU, by double-checking against ordered lists of words that must be present in a command to be valid.</p><p>This is configured in the <code>config.ini</code> with optional  parameters in each language section of the form:</p><ul><li><code>&lt;intentname&gt;:must_include = &lt;list of words&gt;</code></li><li><code>&lt;intentname&gt;:must_chain = &lt;list of words&gt;</code></li><li><code>&lt;intentname&gt;:must_span = &lt;list of words&gt;</code></li></ul><p>Examples:</p><ul><li><code>switchOnOff:must_include = on, light</code></li><li><code>switchOnOff:must_include = light, on</code></li><li><code>switchOnOff:must_include = (light|bulb), on</code></li></ul><p>Several lines of colon-separated parts are possible:</p><ul><li>the first part is the intent name (because one <code>config.ini</code> is responsible for all intents of a skill)</li><li>the second part must be exactly one of the phrases <code>must_include</code>, <code>must_chain</code> or <code>must_span</code>.</li><li>the parameter value is a comma-separated list of words or regular expressions.</li></ul><p>For <code>must_include</code> each uttered command must include all words.</p><p>For <code>must_chain</code> each uttered command must include all words and the words must be in the given order.</p><p>For <code>must_span</code> each uttered command must include all words and the words must be in the correct order and they must span the complete command; i.e. the first word in the list must be the first word of the command and the last must be the last one.</p><p>The framework performs this doublecheck before an action is started.  If the complete voice command matches with at least one of the rules the  intent is accepted; if not, the check fails and the session is ended silently.</p><h2 id="Reduce-false-activations-of-intents-by-disabling-intents"><a class="docs-heading-anchor" href="#Reduce-false-activations-of-intents-by-disabling-intents">Reduce false activations of intents by disabling intents</a><a id="Reduce-false-activations-of-intents-by-disabling-intents-1"></a><a class="docs-heading-anchor-permalink" href="#Reduce-false-activations-of-intents-by-disabling-intents" title="Permalink"></a></h2><p><em>Not avaliable yet in v0.9!</em></p><p>The skill <code>DoNotListen</code> with the intents <code>Susi:DoNotListen</code> and <code>Susi:ListenAgain&gt;</code> can be used to temporarily disable intents.</p><p>The intents themself use strict doublechecking (see section above) to make sure, that only very specific commands are recognised.</p><h2 id="Ask-and-answer-Yes-or-No"><a class="docs-heading-anchor" href="#Ask-and-answer-Yes-or-No">Ask and answer Yes-or-No</a><a id="Ask-and-answer-Yes-or-No-1"></a><a class="docs-heading-anchor-permalink" href="#Ask-and-answer-Yes-or-No" title="Permalink"></a></h2><p>An often needed functionality is a quick confirmation feedback of the user. This is provided by the framework function <code>ask_yes_or_no(question)</code>.</p><p>See the following self-exlpaining code as example:</p><pre><code class="language-Julia hljs">&quot;&quot;&quot;
    destroy_action(topic, payload)

Initialise self-destruction.
&quot;&quot;&quot;
function destroy_action(topic, payload)

  # log message:
  print_log(&quot;[Susi:DestroyYourself]: action destroy_action() started.&quot;)

  if ask_yes_or_no(&quot;Do you really want to initiate self-destruction?&quot;)
    publish_end_session(&quot;Self-destruction sequence started!&quot;)
    boom()  # call implementaion
  else
    publish_end_session(&quot;&quot;&quot;OK.
                      Self-destruction sequence is aborted!
                      Live long and in peace.&quot;&quot;&quot;)
  end
  return true
end</code></pre><p>The intent to capture the user response comes with the framework and is activated just for this dialogue.</p><h2 id="Continue-conversation-without-hotword"><a class="docs-heading-anchor" href="#Continue-conversation-without-hotword">Continue conversation without hotword</a><a id="Continue-conversation-without-hotword-1"></a><a class="docs-heading-anchor-permalink" href="#Continue-conversation-without-hotword" title="Permalink"></a></h2><p>Sometimes it is necessary to control a device with a sequence of several comands. In this case it is not natural to speak the hotword everytime. like:</p><blockquote><p><em>hey Snips</em></p><p><em>switch on the light</em></p><p><em>hey Snips</em></p><p><em>dim the light</em></p><p><em>hey Snips</em></p><p><em>dim the light again</em></p><p><em>hey Snips</em></p><p><em>dim the light again</em>    </p></blockquote><p>Instead, we want something like:</p><blockquote><p><em>hey Snips</em></p><p><em>switch on the light</em></p><p><em>dim the light</em></p><p><em>dim the light again</em></p><p><em>dim the light again</em>    </p></blockquote><p>This can be achieved by starting a new session just after an intent is processed. In the HermesMQTT framework this is controlled by two mechanisms:</p><p>The <code>config.jl</code> defines a constant <code>const CONTINUE_WO_HOTWORD = false</code>. <code>false</code> is the default and hence continuation without hotword is disabled by default. To completely disable it for your skill, just set the constant to <code>false</code>.     The second mechanism is the return value of every single skill-action. A new session will only be started if both are true, the constant <code>CONTINUE_WO_HOTWORD</code> and the return value of the function. This way it is possible to decide for each action individually, if a hotword is required for the next command.</p><h2 id="Multi-language-support"><a class="docs-heading-anchor" href="#Multi-language-support">Multi-language support</a><a id="Multi-language-support-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-language-support" title="Permalink"></a></h2><p>Multi-language skills need to be able to switch between laguages. In the context of Snips this requires special handling in two cases:</p><ul><li>All text, uttered by the assistant must be defined in all languages.</li><li>An intent is always tied to one language. Therefore for multi-language skills similar intents (with the same slots) must be created for each supported language.</li></ul><p>Multi-language support ist added in 4 steps:</p><h3 id=")-Define-language-in-config.ini:"><a class="docs-heading-anchor" href="#)-Define-language-in-config.ini:">1) Define language in config.ini:</a><a id=")-Define-language-in-config.ini:-1"></a><a class="docs-heading-anchor-permalink" href="#)-Define-language-in-config.ini:" title="Permalink"></a></h3><p>The <code>config.ini</code> must have a line like:</p><pre><code class="language-Julia hljs">language=en</code></pre><h3 id=")-Define-the-texts-snippets-in-all-languages:"><a class="docs-heading-anchor" href="#)-Define-the-texts-snippets-in-all-languages:">2) Define the texts snippets in all languages:</a><a id=")-Define-the-texts-snippets-in-all-languages:-1"></a><a class="docs-heading-anchor-permalink" href="#)-Define-the-texts-snippets-in-all-languages:" title="Permalink"></a></h3><p>To let the assistant speak different languages, all texts  must be added to a database for all target languages. These are defined in the  <code>config.ini</code> file by connecting a language, a key and the sentence. Text sniplets for each key must be defined in each language:</p><pre><code class="nohighlight hljs">[de]
:skill_echo =  Hallo, ich bin die Hermes-Skill
:slot_echo_1 = der Wert des Slots
:slot_echo_2 = ist
:end_say =     das wars
:ask_echo_slots = soll ich die Slots des Intent aufsagen?
:no_slots =    der Intent hat keine Slots

[en]
:skill_echo =  hello, i am the Hermes skill
:skill_echo =  i am your new Hermes skill
:skill_echo =  i am 
:slot_echo_1 = the value of the slot
:slot_echo_2 = is
:end_say =     and done
:ask_echo_slots = do you want me to list the slots of this intent?
:no_slots =    the intent has no slots
...</code></pre><ul><li><strong>language:</strong> Sentences for each language are defined in sections of        the config file with the 2-character language codes as heading.</li><li><strong>key:</strong> Keys are <em>julia</em>-style Symbols and can be specified with a       leading colon (however this is not mandatory, just good style).       Several sentences can be provided with the same key -        the <code>HermesMQTT.publish_say()</code> will select one of the sentences       randomly.</li><li><strong>sentence:</strong> The sentence is added after the <code>=</code> without quoting.</li></ul><h3 id=")-Create-similar-intents-for-all-languages:"><a class="docs-heading-anchor" href="#)-Create-similar-intents-for-all-languages:">3) Create similar intents for all languages:</a><a id=")-Create-similar-intents-for-all-languages:-1"></a><a class="docs-heading-anchor-permalink" href="#)-Create-similar-intents-for-all-languages:" title="Permalink"></a></h3><p>The most time-consuming step ist to create the intents in the Snips/Rhasspy console - however this is necessary, because speach-to-text as well as natural language understanding highly depend on the language.</p><h3 id=")-Switch-between-languages:"><a class="docs-heading-anchor" href="#)-Switch-between-languages:">4) Switch between languages:</a><a id=")-Switch-between-languages:-1"></a><a class="docs-heading-anchor-permalink" href="#)-Switch-between-languages:" title="Permalink"></a></h3><p>A language can be selected in the <code>config.ini</code> of <code>HermesMQTT</code> or  the <code>config.ini</code> of each skill.</p><h3 id=")-Utter-texts-in-the-defined-language:"><a class="docs-heading-anchor" href="#)-Utter-texts-in-the-defined-language:">5) Utter texts in the defined language:</a><a id=")-Utter-texts-in-the-defined-language:-1"></a><a class="docs-heading-anchor-permalink" href="#)-Utter-texts-in-the-defined-language:" title="Permalink"></a></h3><p>In the code, the text sniplets can be used by specifying the keys (as Symbols) just like String literals or values and lined up, such as:</p><pre><code class="language-Julia hljs">publish_end_session(&quot;This is a hard-coded message&quot;)
publish_end_session(:skill_echo)
publish_end_session(:skill_echo, &quot;This is a hard-coded message&quot;)

str = &quot;String variable&quot;
val = 42
publish_end_session(:skill_echo, &quot;and values from variables&quot;, 
                    &quot;string&quot;, str, &quot;or value&quot;, val)</code></pre><h2 id="Publishing-intents-programmically"><a class="docs-heading-anchor" href="#Publishing-intents-programmically">Publishing intents programmically</a><a id="Publishing-intents-programmically-1"></a><a class="docs-heading-anchor-permalink" href="#Publishing-intents-programmically" title="Permalink"></a></h2><p>Triggers extend the concept of sending MQTT-messages between assistant components to communication between apps or the system or timers and apps.</p><p>By publishing intents from program code, it is possible to</p><ul><li>execute actions in other skills (by publishing the respective intents)</li><li>execute action at a specified a time with help of the <code>Susi:Schdeule</code> skill.</li></ul><h2 id="Managing-the-Julia-footprint"><a class="docs-heading-anchor" href="#Managing-the-Julia-footprint">Managing the Julia footprint</a><a id="Managing-the-Julia-footprint-1"></a><a class="docs-heading-anchor-permalink" href="#Managing-the-Julia-footprint" title="Permalink"></a></h2><p>Unfortunately, the language Julia has a much bigger  footprint as Python, consuming pretty much memory per Julia instance. In consequence it is not possible to run many Julia skills as separate processes, like it is possible with Python programs.</p><p>To work around this issue, all skills within this framework are running in the same Julia procress.  This reduces the footprint as well as the compile times (because the libraries must be compiled only once).</p><p>To run the HermesMQTT skills, all skills must be installed  in directories parallel to <code>HermesMQTT</code>. When the <code>action-*.jl</code> of HermesMQTT is executed, it will load all other <code>loader-*.jl</code> functions and load the skills.</p><p>All skills are executed in parallel  (thanks to Julia this is super easy to implement) and as separate Modules, so that the namespaces are separated and each skill can be implemented without caring about the rest.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../install/">« Installation</a><a class="docs-footer-nextpage" href="../makeskill/">New skill tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 26 March 2023 13:59">Sunday 26 March 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
